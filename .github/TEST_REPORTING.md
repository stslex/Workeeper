# Android UI Test Reporting

This document describes the comprehensive test reporting setup for Android UI tests in this project.

## Overview

The project uses multiple ready-made GitHub Actions to provide rich, informative test reports
directly in Pull Requests and GitHub Actions runs. No custom scripts needed!

## Test Reporting Tools

### 1. EnricoMi/publish-unit-test-result-action

**Purpose:** Primary test result publisher with trend analysis and PR comments

**Features:**

- âœ… Pass/fail statistics with detailed counts
- ğŸ“Š Test duration tracking
- ğŸ“ˆ Historical comparison with previous runs
- ğŸ”„ **Automatic PR comments** with test results summary
- ğŸ“ Individual test case details
- ğŸ” Direct links to failed tests
- âš¡ Test performance trends

**What you get in PR:**

- Summary comment with pass/fail counts
- Comparison with previous test runs
- Links to check runs for details

**Location:**

- Check "ğŸ§ª UI Test Results" in the Checks tab
- Automatic comment in PR with summary

### 2. mikepenz/action-junit-report

**Purpose:** Detailed JUnit test report with comprehensive breakdown and job summary

**Features:**

- âœ… Detailed pass/fail/skip counts per test
- ğŸ¯ Test execution time per individual test
- ğŸ“‹ Test suite breakdown by module
- âš ï¸ Failure messages and full stack traces
- ğŸ“Š **Rich job summary** in workflow run page
- ğŸ”— Clickable links to test files
- ğŸ“ˆ Visual test statistics

**What you get:**

- Beautiful HTML-like summary in workflow run
- Test results grouped by module
- Quick overview of all test statuses

**Location:**

- Check "ğŸ“Š Detailed Test Report" in the Checks tab
- Summary visible in workflow run page

### 3. dorny/test-reporter

**Purpose:** Visual test execution report with code annotations

**Features:**

- ğŸ“ˆ Visual test results summary
- ğŸ“ **Code annotations** for failed tests (shows exactly where tests are)
- ğŸ” Filterable and searchable test results
- â±ï¸ Performance metrics per test
- ğŸ“Š Pass rate visualization
- ğŸ¯ Test grouping by class/suite

**What you get:**

- File annotations pointing to test code
- Interactive test result viewer
- Quick filtering by pass/fail/skip

**Location:**

- Check "ğŸ“ˆ Test Report" in the Checks tab
- Annotations visible in Files changed tab

## What Gets Reported

### In Pull Requests

When you open a PR, you'll automatically get:

1. **Check Status** - âœ…/âŒ status for each API level tested in the PR checks section
2. **Test Summary Comment** - Auto-generated by EnricoMi action with:
    - Total tests run
    - Pass/fail/skip statistics
    - Pass rate percentage
    - Comparison with previous run (trend â†—ï¸/â†˜ï¸)
    - Links to check runs for details
    - Individual test results

3. **Code Annotations** - Failed tests show annotations on exact lines in your test files
4. **Check Runs** - Three separate detailed reports you can click on:
    - ğŸ§ª UI Test Results
    - ğŸ“Š Detailed Test Report
    - ğŸ“ˆ Test Report

### Example: What You'll See

**In PR Comments:**

```
ğŸ§ª UI Test Results (API 34)

8 tests   +1   8 âœ…  8s â±ï¸
3 suites  Â±0   0 ğŸ’¤
1 files   Â±0   0 âŒ

Results for commit abc1234. Â± Comparison against earlier commit def5678.

âœ… All tests passed!
```

**In Checks Tab:**

- ğŸ§ª UI Test Results (API 34) - âœ… Passed
- ğŸ“Š Detailed Test Report (API 34) - âœ… Passed
- ğŸ“ˆ Test Report (API 34) - âœ… Passed

**In Workflow Summary:**
Beautiful HTML table with:

- Test names
- Execution time
- Pass/Fail status
- Module grouping
- Stack traces for failures

## Available Artifacts

After each test run, the following artifacts are uploaded and available for download:

| Artifact                         | Contents                       | Retention | Notes             |
|----------------------------------|--------------------------------|-----------|-------------------|
| ğŸ“Š `ui-test-reports-api-{level}` | HTML test reports, XML results | 30 days   | Full test reports |
| ğŸ“¸ `screenshots-api-{level}`     | Screenshots of failed UI tests | 14 days   | Only on failures  |
| ğŸ“ `logcat-api-{level}`          | Android logcat output          | 7 days    | Debugging info    |

**How to download:**

1. Go to workflow run page
2. Scroll to bottom "Artifacts" section
3. Click to download ZIP file

## How to Read Test Reports

### Quick Start Guide

**Step 1: Check PR status**

- âœ… Green check = All tests passed
- âŒ Red X = Some tests failed
- ğŸŸ¡ Yellow = Tests running

**Step 2: Read auto-comment**

- Summary with pass/fail counts
- Trend comparison (â†—ï¸ more tests, â†˜ï¸ fewer tests)
- Links to detailed checks

**Step 3: Click on checks for details**

- "ğŸ§ª UI Test Results" - Overall summary
- "ğŸ“Š Detailed Test Report" - Per-test breakdown
- "ğŸ“ˆ Test Report" - Visual report with annotations

**Step 4: If tests failed**

- Check annotations in test files
- Read stack traces in check details
- Download screenshots artifact
- Download logcat for debugging

## Interpreting Test Results

### Pass Rate Indicators

| Pass Rate | Status             | Action Required              |
|-----------|--------------------|------------------------------|
| 100%      | âœ… Excellent        | No action needed             |
| 90-99%    | âš ï¸ Good            | Review failed tests          |
| 80-89%    | âš ï¸ Needs attention | Fix failing tests            |
| < 80%     | âŒ Critical         | Immediate attention required |

### Common Failure Patterns

#### UI Element Not Found

```
android.view.ViewNotFoundException: No views in hierarchy found matching...
```

**Cause:** Test tag mismatch or UI not rendered
**Fix:** Verify test tags and wait for UI to load

#### Timeout

```
androidx.compose.ui.test.junit4.android.ComposeNotIdleException
```

**Cause:** UI operation took too long
**Fix:** Increase timeout or check for infinite animations

#### Assertion Failed

```
java.lang.AssertionError: Expected: true, Actual: false
```

**Cause:** Test expectation doesn't match actual behavior
**Fix:** Review test logic or fix implementation

## Configuration

### Test Matrix

Current test configuration:

- **API Level:** 34 (Android 14)
- **Target:** google_apis
- **Architecture:** x86_64

**To add more API levels:**
Edit `.github/workflows/android_build_unified.yml`:

```yaml
strategy:
  matrix:
    api-level: [ 29, 33, 34 ]  # Add more levels here
```

### Customizing Reports

All three reporting actions are configured in `.github/workflows/android_build_unified.yml`. Key
settings:

| Action   | Key Options                 | Default     |
|----------|-----------------------------|-------------|
| EnricoMi | `compare_to_earlier_commit` | `true`      |
| EnricoMi | `check_run_annotations`     | `all tests` |
| mikepenz | `detailed_summary`          | `true`      |
| mikepenz | `include_passed`            | `true`      |
| dorny    | `max-annotations`           | `50`        |
| dorny    | `only-summary`              | `false`     |

## Troubleshooting

### No Test Results

**Symptom:** "No tests found" in reports

**Solutions:**

- âœ… Verify tests ran: Check workflow logs
- âœ… Check XML files: Look in `build/outputs/androidTest-results/`
- âœ… Ensure tests not all `@Ignore`d

### Missing Screenshots

**Note:** Screenshots only captured on failures by default

### Report Actions Failing

**Check:**

1. Workflow permissions (set in workflow file)
2. Action versions (use latest)
3. XML format is valid JUnit format
4. Review action logs in workflow run

## Best Practices

### Writing Testable UI

1. **Use Test Tags**
   ```kotlin
   Text(
       text = "Hello",
       modifier = Modifier.testTag("greeting_text")
   )
   ```

2. **Wait for UI**
   ```kotlin
   composeTestRule.waitForIdle()
   composeTestRule.waitUntil(timeoutMillis = 5000) {
       /* condition */
   }
   ```

3. **Descriptive Test Names**
   ```kotlin
   @Test
   fun whenUserClicksLoginButton_thenNavigateToHomeScreen() {
       // Clear test intent
   }
   ```

### Test Organization

1. Group related tests in test suites
2. Use `@Category` or custom annotations for test filtering
3. Separate UI tests from unit tests
4. Keep tests focused and independent

### Performance

1. Use `@Before` and `@After` for setup/cleanup
2. Avoid redundant UI operations
3. Use test fixtures for common data
4. Consider using test sharding for large test suites

## Related Documentation

- [Android Testing Guide](https://developer.android.com/training/testing)
- [Compose Testing](https://developer.android.com/jetpack/compose/testing)
- [GitHub Actions](https://docs.github.com/en/actions)
- [JUnit 4](https://junit.org/junit4/)

## Support

For issues with test reporting:

1. Check GitHub Actions logs
2. Review test XML output
3. Verify action configurations
4. Check GitHub Actions status
